---
title: "G16_Tablas_Tablas_y_Tablas"
output:
  html_document:
    css: tutorial.css
    fig_caption: yes
    highlight: pygments
    theme: simplex
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE)
```
Fecha de la ultima revisión
```{r echo=FALSE}

Sys.Date()
```



```{r, eval=TRUE, echo=FALSE}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color, 
      x)
  } else x
}

#`r colorize("some words in red", "red")`
```

```{r, echo=FALSE, fig.show = "hold", out.width = "20%", fig.align = "default"}
knitr::include_graphics(c("Graficos/hex_ggversa.png", "Graficos/hex_Visualizacion_Datos.png"))
```

test

```{r}
library(ggplot2)
library(tidyverse)
library(ggversa)
library(gt)
library(gridExtra)
```

***

En este documento estaremos evaluando una serie de alternativas y paquetes para preparar tablas.

# Tablas con Markdown
 El primer ejemplo usa el sistema de **markdown** para preparar tablas

***


## Tablas sencillas y R

Las tablas sencillas se usa cuando no hay mucha información y no estamos importando los datos externo o de un objeto de R.  

 - "|", para separar columnas
 - ":", para indentificar si el texto o números estan pegado a la derecha, izquierda y centrado
 - "|-----|", para separar el nombre de las columnas de la información de la tabla 

A ver, mire la **Tabla a** y la **Tabla b**. ¿Encuentra los errores?  Vea que la **Tabla a** muestra los valores con demasiadas cifras significativas, justificaciones ilógicas, formato inconsistente y no especifica las unidades de los valores.  Vemos en la **Tabla b** que ahora las cifras significativas aparecen de forma consistente y en el mismo formato (2da y 3ra columnas), todos los números están justificados a la derecha y las unidades de cm se especifican (3ra columna).  

En conclusión, no solo la **Tabla b** se ve más presentable, si no que también corrige los problemas, de ahí la importancia de presentar datos tabulados de forma que facilite su comunicación a la audiencia.

***
  
**Tabla a.  Errores de formato, justificación y escala**
  
|Genero| Tamaño de muestra | El largo de la hoja | valor de p |
|---------|:-------|:--------:|:-------------|
| Mujeres | 27273 |  11.03  | 0.000000001 |
| Hombres | 169019 | 13.5  | 0.098979676 |
| Especie  | 1.087^6 | 14.5  | .0300001 |


***

**Tabla b. Errores anteriores corregidos**

|         | Tamaño de muestra | El largo de la hoja (cm) | valor de p  |
|:---------|-------:|--------:|-------------:|
| Mujeres | 27273 | 11.0  | <0.001 |
| Hombres | 169019 | 13.5 | 0.099 |
| Especie  | 1087669 | 14.5  | 0.030 |

Para facilitar la producción de una tabla siempre puede usar este enlace 

https://www.tablesgenerator.com/markdown_tables

***

1. **Ejercicio**

Prepara una tabla de la lista de tu familia, nombre de tu madre, abuelas y cuantos hijos tienen. Los nombres deberían esta justificado a la izquierda y la cantidad de hijos a la derecha, en una tercera columna pon el municipio donde nacio esa persona.

***


# tibble y tribble


Un tibble es una tabla que es muy similar a un data frame, con algunas diferencias que le hace más fácil encontrar errores y imprimir esas tablas.  Aqui vemos un data frame que fue convertida en tibble, a evaluar la tabla no se ve ninguna diferencia. Vea este enlace para más información https://r4ds.had.co.nz/tibbles.html 


El archivo esta un formato "data frame" y "A" esta en un formato tibble.  Nota que no se ve diferencias entre los dos a simple vista.  Pero es importante que sepa detras en el codigo del formato, hay codificación que puede facilitar o no un analisis en cada uno de las opciones.   


```{r}
library(ggversa)
library(tibble)
Anolis

A=as_tibble(Anolis)
A
```

***


## Crear un tibble en un documento .Rmd

## tribble

Constuir una tabla con tribble

```{r}
Tabla=tribble(~"Nombre Cientifico de las Especies", ~"Nombre Comun", ~N,
        "Especie_1", "Angelito", 10,
        "Especie_2", "...", 300,
        "Prestoea montana","Palma de Sierra", 1,
        "....","...", NA
        )
Tabla
```


***


# El paquete **gt**

El paquete **gt** es the "Grammar of tables", y la función principal es "gt". Si usamos la tabla que creamos anteriomente se puede mejor la aparencia de la tabla

```{r}
library(gt)
gt(head(A))
```


Vea este enlace para información de las funciones de **gt** https://gt.rstudio.com y este https://themockup.blog/static/gt-cookbook.html

***

## Añadiendo titulo y referencia a una tabla gt

```{r}

A %>% 
  dplyr::select(STUDY, Survey_Site, TIME, DATE, SEASON, SEX_AGE, SVL) %>% 
  head() %>% 
  gt() %>% 
  tab_header(title = "Datos sobre la presencia y tamaño de *Anolis* en la estación El Verde, PR",
             subtitle = "Datos recolectado por Douglas Reagan" )
  

```


***

## Añadiendo italico a algunas palabras

```{r}

A %>% 
  dplyr::select(STUDY, Survey_Site, TIME, DATE, SEASON, SEX_AGE, SVL) %>% 
  head() %>% 
  gt() %>% 
  tab_header(title = md("Datos sobre la presencia y tamanõ de *Anolis* en la estación **El Verde**, PR"),
             subtitle = "Datos recolectado por Douglas Reagan" )
  

```

***

## Añadiendo una referencia

https://luq.lter.network/data/luqmetadata1


```{r}
A %>% 
  select(STUDY, Survey_Site, TIME, DATE, SEASON, SEX_AGE, SVL) %>% 
  head() %>% 
  gt() %>% 
  tab_header(title = md("Datos sobre la presencia y tamanõ de *Anolis* en la estación El Verde, PR"),
             subtitle = "Datos recolectado por Douglas Reagan" ) %>% 
  tab_source_note(
    source_note = "https://luq.lter.network/data/luqmetadata1")
  

```

***

## Identificando una celda especifica con un **footnote**

```{r}
AA=A %>% 
  select(STUDY, Survey_Site, TIME, DATE, SEASON, SEX_AGE, SVL) %>% 
  head() %>% 
  gt() %>% 
  tab_header(title = md("Datos sobre la presencia y tamanõ de *Anolis* en la estación El Verde, PR"),
             subtitle = "Datos recolectado por Douglas Reagan" ) %>% 
  tab_source_note(
    source_note = "https://luq.lter.network/data/luqmetadata1") %>% 
  tab_footnote(
    footnote = "Podria haber sido confundido con un extraterrestre",
    locations = cells_body(columns=SEX_AGE, rows = 2)
  ) %>% 
    tab_footnote(
    footnote = "Podria ",
    locations = cells_body(columns=SEX_AGE, rows = 3)
  )%>% 
    tab_footnote(
    footnote = "yo ",
    locations = cells_body(columns=SEX_AGE, rows = 3)
  )
AA
```



***

```{r}
AA %>% 
  tab_style(
    style = list(cell_fill(color = "Orange")),
    locations = cells_body(columns = STUDY)
  )%>% 
  tab_style(
    style = list(cell_fill(color = "Red")),
    locations = cells_body(columns = DATE)
  )

```


***

```{r}
AA %>% 
  tab_style(
    style = list(cell_fill(color = "Orange")),
    locations = cells_body(columns = STUDY, rows = 1)
  ) %>% 
  tab_style(
    style = list(cell_text(color = "Orange")),
    locations = cells_body(columns=SEX_AGE, rows = 3)
  )
```

***


```{r}
AAA=AA %>% 
  tab_style(
    style = list(cell_fill(color = "Orange")),
    locations = cells_body(columns = STUDY)
  ) %>% 
  tab_style(
    style = list(cell_text(color = "Orange")),
    locations = cells_body(columns=SEX_AGE, rows = 3)
  ) %>% 
    tab_style(
    style = list(cell_text(style = "italic", weight = "bold")),
    locations = cells_body(columns=Survey_Site, rows = 1)
    )

AAA
```


***

# Formateo condicional

Aqui usamos la condición de **SVL** sea debajo un tamaño o más grande y se le asigna un color correspondiente.




```{r}

AAAA= AAA |> 
  tab_style(
    style = cell_text(color = "red", weight = "bold"),
    locations = cells_body(
      columns = vars(SVL),
      rows = SVL < 38
    )
  ) |>  
  tab_style(
    style = cell_text(color = "blue", weight = "bold"),
    locations = cells_body(
      columns = vars(SVL),
      rows = SVL >= 38
    )
  )


AAAA
```





***


## Cambiar los fonts de una columna especifica o de toda la tabla

Para aceso alos fonts de google vea este enlace

https://fonts.google.com




```{r eval=FALSE, include=FALSE}
small_table=AAAA %>% 
  tab_style(
    style = cell_text(
      font = google_font("Indie Flower"), 
      weight = "bold",
      size = px(20)
      ),
    locations = cells_column_labels(everything())
  ) %>% 
   tab_style(
    style = cell_text(
    font = google_font("Redressed"), size = px(14)),
    locations = cells_body(columns = everything())
  ) %>% 
  tab_style(
    style = cell_text(
    font = google_font("Redressed"), size = px(14)),
    locations = tab_header
  )


small_table

gtsave(small_table, "gt_table_excercise.png")


```


<br>

***



***

# flextable package


```{r}
library(flextable)
```


### Flexable website

https://ardata-fr.github.io/flextable-book/index.html


```{r}
library(flextable)
ft <- flextable(airquality[ sample.int(10),])
ft <- add_header_row(ft,
  colwidths = c(4, 2),
  values = c("Air quality", "Time")
)
ft <- theme_vanilla(ft)
ft <- add_footer_lines(ft, "Daily air quality measurements in New York, May to September 1973.")
ft <- color(ft, part = "footer", color = "#666666")
ft <- set_caption(ft, caption = "New York Air Quality Measurements")
ft

#tf <- tempfile(fileext = ".docx")
save_as_pptx("ft1" = ft, path = "/Users/raymondtremblay/Dropbox/GitHub_Dropbox_Drive/GitHub/Visualizacion_Datos/ft.pptx")

save_as_docx("ft1" = ft, path = "/Users/raymondtremblay/Dropbox/GitHub_Dropbox_Drive/GitHub/Visualizacion_Datos/ft.docx")

```

```{r}
#install.packages("openxlsx", dependencies = TRUE)
library(openxlsx)

#write.xlsx(ft, "writeList2.xlsx", colWidths = 20)
```

